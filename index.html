<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scraped Names</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .names-list {
            list-style-type: decimal;
            line-height: 1.6;
            padding-left: 20px;
        }
        .name-item {
            margin-bottom: 15px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
            transition: all 0.2s;
        }
        .name-item:hover {
            background-color: #f0f8ff;
            border-color: #bbb;
        }
        .name-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .name-text {
            font-weight: bold;
            color: #333;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .clickable-name {
            cursor: pointer;
            transition: all 0.2s;
            padding: 2px 4px;
            border-radius: 4px;
        }
        .clickable-name:hover {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        .copy-feedback {
            background-color: #4caf50 !important;
            color: white !important;
            transform: scale(1.05);
        }
        .nationality-flag {
            font-size: 18px;
            margin-right: 5px;
        }
        .nationality-text {
            font-size: 12px;
            color: #666;
            font-weight: normal;
            background-color: #e9ecef;
            padding: 2px 6px;
            border-radius: 12px;
            margin-left: 5px;
        }
        .nationality-override-btn {
            background: none;
            border: none;
            font-size: 14px;
            cursor: pointer;
            margin-left: 5px;
            padding: 2px 4px;
            border-radius: 3px;
            transition: background-color 0.2s;
        }
        .nationality-override-btn:hover {
            background-color: #f0f0f0;
        }
        .nationality-selector {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            max-height: 400px;
            overflow-y: auto;
        }
        .nationality-selector h3 {
            margin: 0 0 15px 0;
            color: #333;
        }
        .nationality-option {
            display: block;
            width: 100%;
            padding: 8px 12px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
            cursor: pointer;
            text-align: left;
            font-size: 14px;
        }
        .nationality-option:hover {
            background: #e9ecef;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
        .phd-selector {
            margin-left: 10px;
        }
        .phd-checkbox {
            margin-right: 5px;
            transform: scale(1.2);
        }
        .phd-selected {
            background-color: #fff3cd !important;
            border-color: #ffc107 !important;
        }
        .phd-counter {
            background-color: #28a745;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
            margin-left: 10px;
        }
        .selection-controls {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .recommended-badge {
            background-color: #dc3545;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 8px;
            margin-left: 5px;
            font-weight: bold;
        }
        .note-toggle {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.2s;
        }
        .note-toggle:hover {
            background-color: #45a049;
        }
        .note-toggle.has-note {
            background-color: #2196F3;
        }
        .note-toggle.has-note:hover {
            background-color: #1976D2;
        }
        .note-section {
            display: none;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
        }
        .note-section.active {
            display: block;
        }
        .note-textarea {
            width: 100%;
            min-height: 80px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
        }
        .note-display {
            width: 100%;
            min-height: 80px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: inherit;
            font-size: 14px;
            background-color: #f9f9f9;
            line-height: 1.4;
            display: none;
        }
        .note-display.active {
            display: block;
        }
        .note-display a {
            color: #007bff;
            text-decoration: underline;
            word-break: break-all;
        }
        .note-display a:hover {
            color: #0056b3;
        }
        .edit-toggle {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 8px;
        }
        .edit-toggle:hover {
            background-color: #545b62;
        }
        .note-actions {
            margin-top: 8px;
            display: flex;
            gap: 8px;
        }
        .save-note, .clear-note {
            padding: 5px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .save-note {
            background-color: #4CAF50;
            color: white;
        }
        .save-note:hover {
            background-color: #45a049;
        }
        .clear-note {
            background-color: #f44336;
            color: white;
        }
        .clear-note:hover {
            background-color: #da190b;
        }
        .search-container {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .search-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .search-filter {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .count {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Names List with Notes</h1>
        <div class="count" id="nameCount"></div>
        <p> <a href="https://apply.ellis.eu/applicants/5716/edit" > The resistration Link  </a> </p>
        
        <div class="selection-controls">
            <h3>üéì PhD Supervisor Selection <span class="phd-counter" id="phdCounter">0/10 selected</span></h3>
            <p>Select up to 10 potential PhD supervisors from the list below. Recommended candidates are marked with ‚≠ê.</p>
            <button class="save-note" onclick="showSelectedList()">View Selected List</button>
            <button class="clear-note" onclick="clearAllSelections()">Clear All</button>
            <button class="save-note" onclick="analyzeUnknownNames()" style="background-color: #17a2b8;">üîç Analyze Unknown Names</button>
            <button class="save-note" onclick="testTableNames()" style="background-color: #28a745;">üß™ Test Table Names</button>
        </div>
        
        <div class="search-container">
            <input type="text" class="search-input" id="searchInput" placeholder="Search names...">
            <select class="search-filter" id="filterSelect">
                <option value="all">All Names</option>
                <option value="with-notes">Names with Notes</option>
                <option value="without-notes">Names without Notes</option>
                <option value="selected-phd">Selected PhD Candidates</option>
            </select>
            <select class="search-filter" id="countryFilter">
                <option value="all">All Countries</option>
                <option value="German">üá©üá™ German</option>
                <option value="Italian">üáÆüáπ Italian</option>
                <option value="French">üá´üá∑ French</option>
                <option value="Arabic/Middle Eastern">üá∏üá¶ Arabic/Middle Eastern</option>
                <option value="Chinese">üá®üá≥ Chinese</option>
                <option value="Scandinavian">üá∏üá™ Scandinavian</option>
                <option value="Dutch">üá≥üá± Dutch</option>
                <option value="Polish">üáµüá± Polish</option>
                <option value="Greek">üá¨üá∑ Greek</option>
                <option value="Turkish">üáπüá∑ Turkish</option>
                <option value="Indian">üáÆüá≥ Indian</option>
                <option value="British">üá¨üáß British</option>
                <option value="Finnish">üá´üáÆ Finnish</option>
                <option value="Romanian">üá∑üá¥ Romanian</option>
                <option value="Portuguese">üáµüáπ Portuguese</option>
                <option value="Lithuanian">üá±üáπ Lithuanian</option>
                <option value="Spanish">üá™üá∏ Spanish</option>
                <option value="European">üá™üá∫ European</option>
                <option value="Unknown">üåç Unknown</option>
            </select>
        </div>
        
        <div class="names-list" id="namesList">
        </div>
    </div>

    <script>
        // Array of all the names extracted from the original HTML
        const names = [
            "Sahar Abdelnabi",
            "Monika Aidelsburger",
            "Zeynep Akata",
            "Dan Alistarh",
            "Maksym Andriushchenko",
            "Plamen Angelov",
            "Yuki Asano",
            "Isabelle Augenstein",
            "Giuseppe Averta",
            "Robert Babuska",
            "Alison Barker",
            "Sven Behnke",
            "Yonatan Belinkov",
            "Serge Belongie",
            "Sagie Benaim",
            "Peter Benner",
            "Philipp Berens",
            "Alexandre Bernardino",
            "Hakan Bilen",
            "Carsten Binnig",
            "Bernd Bischl",
            "Gilles Blanchard",
            "Christoph Bock",
            "Ilija Bogunovic",
            "Aleksandar Bojchevski",
            "Karsten Borgwardt",
            "Viacheslav Borovitskiy",
            "Wieland Brendel",
            "Thomas Brox",
            "Marin Bukov",
            "Esra Bulbul",
            "Andreas Bulling",
            "ADRIAN Bunzel",
            "Rebekka Burkholz",
            "Gustau Camps-Valls",
            "Andrea Cavallaro",
            "Michele Ceriotti",
            "Nicol√≤ Cesa-Bianchi",
            "Georgia Chalvatzaki",
            "Sarath Chandar",
            "Angel Chang",
            "Qi Chen",
            "Carlo Ciliberto",
            "Cecilia Clementi",
            "Michael Cochez",
            "Marcella Cornia",
            "Iain Couzin",
            "Daniel Cremers",
            "Francesco Croce",
            "Andrew Cropper",
            "Florence d'Alch√©",
            "Angela Dai",
            "Dima Damen",
            "Maximilian Dax",
            "Joachim Denzler",
            "Audrey Durand",
            "Marcus Ebeling",
            "Samira Ebrahimi Kahou",
            "Alexander Ecker",
            "Mennatallah El-Assady",
            "Christoph Engel",
            "Veronika Eyring",
            "Azade Farshad",
            "Tommaso Fellin",
            "Michael Felsberg",
            "Stefan Feuerriegel",
            "Nicolas Flammarion",
            "Vincent Fortuin",
            "Gianni Franchi",
            "Clyde Francks",
            "Mario Fritz",
            "Pascal Frossard",
            "Johannes F√ºrnkranz",
            "Juergen Gall",
            "Ana J. Garcia Saez",
            "NICOLA GATTI",
            "Bernhard Geiger",
            "Mario Giulianelli",
            "Manuel Gomez Rodriguez",
            "Henry Gouk",
            "Arthur Gretton",
            "Jinjin Gu",
            "Iryna Gurevych",
            "Moritz Hardt",
            "Dietmar Harhoff",
            "Heather Harrington",
            "Jason Hartford",
            "S√∏ren Hauberg",
            "Fengxiang He",
            "Nidhi Hegde",
            "Matthias Hein",
            "Moritz Helmstaedter",
            "Philipp Hennig",
            "Ralf Herbrich",
            "Jose Miguel Hernandez Lobato",
            "Daniel Hern√°ndez-Lobato",
            "Sepp Hochreiter",
            "Christian Holz",
            "Thorsten Holz",
            "Antti Honkela",
            "Wolfgang Huber",
            "Eyke H√ºllermeier",
            "Madelon Hulsebos",
            "Frank Hutter",
            "Eddy Ilg",
            "Leonardo Impett",
            "Dimo Ivanov",
            "Martin Jaggi",
            "Nils Jansen",
            "Stefanie Jegelka",
            "Shaoxiong Ji",
            "Shijie Jiang",
            "Zhijing Jin",
            "Dagmar Kainmueller",
            "Vicky Kalogeiton",
            "Maryam Kamgarpour",
            "Dimosthenis Karatzas",
            "Kimmo Kartasalo",
            "Mikko Karttunen",
            "Samuel Kaski",
            "Frank Keller",
            "Niki Kilbertus",
            "G√ºnter Klambauer",
            "Arto Klami",
            "Almut-Sophia Koepke",
            "Heinz Koeppl",
            "Alexander Koller",
            "Nikola Konstantinov",
            "Anna Korhonen",
            "Hilde Kuehne",
            "Zuzana Kukelova",
            "Matt Kusner",
            "Gitta Kutyniok",
            "Christoph Lampert",
            "Robert Legenstein",
            "Jan Eric Lenssen",
            "Bruno Lepri",
            "Changjian Li",
            "Renjie Liao",
            "Or Litany",
            "Shiwei Liu",
            "Francesco Locatello",
            "Po-Ling Loh",
            "Manuel Lopes",
            "ulrike luxburg",
            "Oisin Mac Aodha",
            "Jakob Macke",
            "Enrico Magli",
            "Rupam Mahmood",
            "Lena Maier-Hein",
            "Klaus Maier-Hein",
            "Rupak Majumdar",
            "Alberto Marchesi",
            "Florian Marquardt",
            "David Martinez-Rubio",
            "Georg Martius",
            "Jiri Matas",
            "Celestine Mendler-D√ºnner",
            "Alberto Maria Metelli",
            "Mira Mezini",
            "Marie-Francine Moens",
            "Peyman Mohajerin Esfahani",
            "Paul Molli√®re",
            "Marco Mondelli",
            "Krikamol Muandet",
            "Vittorio Murino",
            "Siddharth Narayanaswamy",
            "Lorenzo Natale",
            "Nassir Navab",
            "Gergely Neu",
            "Joerg Neugebauer",
            "Mathias Niepert",
            "Matthias Niessner",
            "Feliks N√ºske",
            "Arlindo Oliveira",
            "Nuria Oliver",
            "Simon Olsson",
            "Bj√∂rn Ommer",
            "Antti Oulasvirta",
            "Edouard Oyallon",
            "Asli Ozyurek",
            "Wei Pan",
            "M. Alessandra Papa",
            "Simone Parisi",
            "Stuart Parkin",
            "ioannis patras",
            "Danda Pani Paudel",
            "Robert Peharz",
            "Francisco Pereira",
            "Jonas Peters",
            "Thierry Poibeau",
            "Marc Pollefeys",
            "Edoardo Ponti",
            "Massimiliano Pontil",
            "Viola Priesemann",
            "Natasa Przulj",
            "Kai Puolam√§ki",
            "Dierk Raabe",
            "Rosanne Rademaker",
            "Iyad Rahwan",
            "Gunnar R√§tsch",
            "Markus Reichstein",
            "Elisa Ricci",
            "Harald Ringbauer",
            "Hans-Walter Rix",
            "Matthew Robinson",
            "Marcus Rohrbach",
            "Anna Rohrbach",
            "Lorenzo Rosasco",
            "Mariana Rossi",
            "Paolo Rota",
            "Stefan Roth",
            "Constantin Rothkopf",
            "Angel Rubio",
            "Laura Ruotsalainen",
            "T. Konstantin Rusch",
            "Reza Sabzevari",
            "Mrinmaya Sachan",
            "Julio Saez-Rodriguez",
            "Wojciech Samek",
            "Piotr Sankowski",
            "Amartya Sanyal",
            "Torsten Sattler",
            "Matteo Saveriano",
            "Simone Schaub-Meyer",
            "Bernt Schiele",
            "Cordelia Schmid",
            "Julia Schnabel",
            "Bernhard Sch√∂lkopf",
            "Martin Schrimpf",
            "Nicu Sebe",
            "Lorenzo Seidenari",
            "Laura Sevilla",
            "Freda Shi",
            "Ricardo Silva",
            "Josef Sivic",
            "Johannes Soeding",
            "Manuel Spitschan",
            "Suvrit Sra",
            "Oliver Stegle",
            "Sebastian Stich",
            "Birgit Stiller",
            "Amos Storkey",
            "Alessandro Suglia",
            "Mingfei Sun",
            "Ewa Szczurek",
            "Siyu Tang",
            "Graham Taylor",
            "Matthew Taylor",
            "Dorina Thanou",
            "Fabian Theis",
            "Christian Theobalt",
            "Justus Thies",
            "Radu Timofte",
            "Tatiana Tommasi",
            "Mariya Toneva",
            "Laura Toni",
            "Carme Torras",
            "Marc Toussaint",
            "Tomasz Trzci≈Ñski",
            "Dimitris Tzionas",
            "Abhinav Valada",
            "Isabel Valera",
            "Sofie Valk",
            "Silvana Valtcheva",
            "Tim van Erven",
            "Tejs Vegge",
            "Aki Vehtari",
            "Britta Velten",
            "Antonio Vergari",
            "Arno Villringer",
            "Jilles Vreeken",
            "Melanie Wald-Fuhrmann",
            "Yuxia Wang",
            "Felix Warmer",
            "Nikolaus Weiskopf",
            "Robert West",
            "Anna Wienhard",
            "Martin Wikelski",
            "Guy Wolf",
            "Elliott (Shangzhe) Wu",
            "fanny Yang",
            "Jiancheng Yang",
            "Emine Yilmaz",
            "Angela Yu",
            "Jan Zahalka",
            "Amir Zamir",
            "Chrysoula Zerva",
            "Guoying Zhao",
            "Xiaoxiang Zhu",
            "Xiaojue Zhu",
            "Indrƒó ≈Ωliobaitƒó"
        ];

        // Nationality detection based on names
        function guessNationality(name) {
            const nameLower = name.toLowerCase();
            const firstName = nameLower.split(' ')[0];
            const lastName = nameLower.split(' ').pop();
            
            // Define patterns for different nationalities
            const patterns = {
                // German
                'German': {
                    flag: 'üá©üá™',
                    patterns: [
                        /\b(wolfgang|frank|bernd|philipp|matthias|sebastian|christian|georg|juergen|joachim|klaus|stefan|thorsten|andreas|florian|jan eric|bernhard|g√ºnter|felix|nikolaus|martin|guy)\b/,
                        /\b(monika|rebekka|britta|julia|birgit|anna|lena|mira|melanie)\b/,
                        /(mueller|m√ºller|schmidt|weber|wagner|becker|schulz|hoffmann|koch|bauer|richter|klein|wolf|schr√∂der|neumann|schwarz|zimmermann|braun|kr√ºger|hartmann|lange|schmitt|werner|schmitz|krause|meier|lehmann|fuchs|albrecht|sommer|m√∂ller|hahn|graf|keller|mayer|huber)$/,
                        /(sch|tz|dt|ff|mann|berg|burg|feld|stein|bach|dorf|hoff|holz|kopf|reich|wald)$/,
                        /\b(christian|matthias|philipp|sebastian|wolfgang|thorsten|stefan|joachim|bernhard|g√ºnter|klaus|andreas|florian|martin|felix|nikolaus)\b/
                    ]
                },
                // Italian  
                'Italian': {
                    flag: 'üáÆüáπ',
                    patterns: [
                        /\b(giuseppe|francesco|lorenzo|paolo|marcella|simone|alberto|enrico|carlo|michele|alessandro|marco|antonio|massimiliano)\b/,
                        /\b(marcella|giulia|elisa|tatiana|laura)\b/,
                        /(rossi|russo|ferrari|esposito|bianchi|romano|colombo|ricci|marino|greco|bruno|gallo|conti|de luca|costa|giordano|mancini|rizzo|lombardi|moretti|barbieri|fontana|santoro|mariani|rinaldi|caruso|ferrari|giuliani|benedetti|villa|pellegrini|serra|palumbo|leone|rosso|martino|marchetti|silvestri|monti|guerra|ferri|costa)$/,
                        /(ini|etti|elli|acci|ucci|otti|asso|illo|ello|ato|ese|esi|ano|ino|olo|oli|ori|eri|eri)$/
                    ]
                },
                // French
                'French': {
                    flag: 'üá´üá∑',
                    patterns: [
                        /\b(florence|thierry|edouard|pascal|angel|marc|carme)\b/,
                        /\b(florence|audrey|marie|cordelia)\b/,
                        /(martin|bernard|thomas|robert|petit|dubois|moreau|laurent|simon|michel|lefebvre|leroy|roux|david|bertrand|morel|fournier|girard|bonnet|dupont|lambert|fontaine|rousseau|vincent|muller|lefevre|faure|andre|mercier|blanc|guerin|boyer|garnier|chevalier|francois|legrand|gauthier|garcia|perrin|robin|clement|morin|nicolas|henry|roussel|mathieu|gautier|masson|marchand|duval|denis|dumont|marie|lemaire|noel|meyer|dufour|meunier|brun|blanchard|giraud|joly|riviere|lucas|brunet|gaillard|barbier|arnaud|martinez|gerard|remy|pierre|colin|vidal|caron|picard|roger|fabre|aubert|lemoine|renaud|dumas|lacroix|olivier|philippe|bourgeois|pierre|renard|michaud|richard|payet|lebon|king|jean|hubert|rey|leclercq|mace|roy|durand|louis|vincent|adam|philippe|marie|julien|david|stephane|nicolas|christophe|jerome|olivier|sebastien|frederic|cyril|benjamin|alexandre|antoine|pierre|michel|bruno|daniel|christian|didier|francis|sylvain|herve|pascal|franck|henri|jean|bernard|robert|maurice|andre|louis|marcel|roger|gerard|jacques|yves|fernand|rene|claude|lucien|paul|albert|joseph|francis|georges|emile|arthur|etienne|raymond|leon|eugene|pierre|denis|vincent|raphael|julien|xavier|emmanuel|maxime|fabien|valentin|jeremy|romain|thomas|guillaume|alexis|florian|lucas|adrien|kevin|loic|yann|vincent|simon|aurelien|mickael|jeremy|gaetan)$/,
                        /(eau|eux|oux|ais|ois|ier|eau|aux|ue)$/
                    ]
                },
                // Arabic/Middle Eastern
                'Arabic/Middle Eastern': {
                    flag: 'üá∏üá¶',
                    patterns: [
                        /\b(sahar|amir|omar|ahmed|hassan|ali|mohammed|abdul|saeed|khalid|nasser|farid|tariq|karim|yasmin|fatima|zahra|aisha|khadija)\b/,
                        /\b(sahar|zahra|fatima|yasmin|aisha|khadija)\b/,
                        /(al|el|ibn|bin|abd|abu|hassan|hussein|rahman|mohammed|ahmad|ali|omar|khalil|mansour|said|salim|nasser|farid|tariq|karim|yazid|zakariya|ibrahim|ismail|yusuf|noah|adam|idris|sulaiman|dawud|hakim|rashid|bashir|nasir|shakir|tahir|zahir|malik|salah|sabir|walid|khalid|majid|jamil|jalal|jamal|kamal|nabil|nadir|qasim|rahim|rami|saad|salam|salman|sameer|sami|talib|wael|waleed|yasser|zain|ziad|ziyad)$/,
                        /(abi|ani|awi|ini|oub|ouk|our|ous)$/
                    ]
                },
                // Chinese
                'Chinese': {
                    flag: 'üá®üá≥',
                    patterns: [
                        /\b(renjie|liao|wei|qi|yuki|mingfei|siyu|yuxia|jiancheng|guoying|xiaoxiang|xiaojue|shangzhe|fanny yang|angel chang)\b/,
                        /\b(wei|qi|yuki|mingfei|siyu|yuxia|jiancheng|fanny|angel)\b/,
                        /(wang|li|zhang|liu|chen|yang|zhao|huang|zhou|wu|xu|sun|ma|zhu|hu|guo|lin|he|gao|luo|zheng|liang|xie|tang|song|xu|deng|han|feng|cao|peng|zeng|xiao|tian|dong|pan|yuan|cai|jiang|yu|du|ye|cheng|su|wei|lu|ding|ren|shen|yao|lu|jiang|cui|qian|tan|lu|zou|shi|meng|xue|duan|lei|long|shi|tao|he|gu|hou|shao|mao|wan|qiu|qin|jiang|yin|bo|kong|bai|cui|kang|mao|liao)$/,
                        /(ang|ing|ong|eng|ian|uan|uang|iang)$/
                    ]
                },
                // Scandinavian (Norwegian, Swedish, Danish)
                'Scandinavian': {
                    flag: 'üá∏üá™',
                    patterns: [
                        /\b(s√∏ren|aki|antti|simon|martin|anna|britta|laura)\b/,
                        /\b(aki|antti|arto|kai|s√∏ren|anna|britta)\b/,
                        /(sson|sen|berg|str√∂m|holm|lund|berg|dahl|lund|strand|nord|sund|kvist|gren|blom|ek|as|√•str√∂m|lindgren|engstr√∂m|hedberg|sj√∂berg|lindberg|linder|lindstr√∂m|sandstr√∂m|blomqvist|hedstr√∂m|wikstr√∂m|holmberg|dahlberg|sundberg|rydberg|bergstr√∂m|lindqvist|martinsson|gustafsson|carlsson|johansson|andersson|karlsson|nilsson|eriksson|larsson|olsson|persson|svensson|gustafsson|pettersson|jonsson|jansson|hansson|bengtsson|j√∂nsson|lindberg|berg|holm|strand|kvist|gren|lund|dahl|qvist)$/,
                        /(ssen|berg|str√∂m|holm|lund|dahl|strand|nord|sund|kvist|gren|blom)$/
                    ]
                },
                // Dutch/Flemish
                'Dutch': {
                    flag: 'üá≥üá±',
                    patterns: [
                        /\b(rosanne|rademaker|sofie|valk|tim van|madelon|jilles)\b/,
                        /\b(rosanne|sofie|madelon)\b/,
                        /(van|de|der|den|ten|ter|op|aan|bij|in|onder|over|uit|voor|na|tegen|tot|vanaf|volgens|tijdens|binnen|buiten|zonder|met|door|naar|voor|achter|boven|onder|tussen|rond|om)(\s)/,
                        /(berg|burg|hof|hoef|dijk|donk|horst|huizen|kamp|meer|wijk|zaal|beek|broek|daal|gaard|haven|heide|kerk|plaats|stad|water|weg|woud|rademaker|valk)$/
                    ]
                },
                // Polish
                'Polish': {
                    flag: 'üáµüá±',
                    patterns: [
                        /\b(tomasz|piotr|ewa)\b/,
                        /\b(ewa)\b/,
                        /(ski|ska|cki|cka|dzki|dzka|owski|owska|ewski|ewska|i≈Ñski|i≈Ñska|y≈Ñski|y≈Ñska)$/,
                        /(kowski|kowska|ewski|ewska|owski|owska|inski|inska|ynski|ynska|cinski|cinska|dzinski|dzinska)$/
                    ]
                },
                // Greek
                'Greek': {
                    flag: 'üá¨üá∑',
                    patterns: [
                        /\b(georgia|dimosthenis|dimitris|chrysoula)\b/,
                        /\b(georgia|chrysoula)\b/,
                        /(poulos|akis|opoulos|atos|ides|akos|ellis|antos|oglou|escu)$/,
                        /(dis|tos|kis|los|nos|ros|sis|lis|mis|nis|pis|ris|tis|vis|xis|zis)$/
                    ]
                },
                // Turkish
                'Turkish': {
                    flag: 'üáπüá∑',
                    patterns: [
                        /\b(hakan|bilen|esra|bulbul|emine|asli)\b/,
                        /\b(emine|asli|esra)\b/,
                        /(oƒülu|√∂zkan|√∂zdemir|√∂zt√ºrk|√∂zen|√∂zer|√ßelik|√ßetin|≈üahin|≈üen|yƒ±lmaz|yƒ±ldƒ±z|yƒ±ldƒ±rƒ±m|kara|kaya|ko√ß|kurt|arslan|aydƒ±n|bayrak|demir|doƒüan|erdoƒüan|g√ºne≈ü|tekin|polat|≈üim≈üek|turan|uysal|yavuz|akƒ±n|acar|akman|ate≈ü|akta≈ü|altƒ±n|aslan|ata≈ü|ayan|ba≈ü|can|duman|erdem|esen|gen√ß|g√ºl|i≈üƒ±k|kƒ±lƒ±√ß|oral|√∂zkan|sahin|ta≈ü|u√ßar|√ºnl√º|uyar|vardar|ya≈üar|bilen|bulbul)$/,
                        /(oƒülu|√∂zkan|√ßelik|≈üahin|yƒ±lmaz|yƒ±ldƒ±z)$/
                    ]
                },
                // Indian/South Asian
                'Indian': {
                    flag: 'üáÆüá≥',
                    patterns: [
                        /\b(rupak|majumdar|abhinav|mrinmaya|suvrit)\b/,
                        /\b(sarath|priya|anita|kavya|meera|sita|uma|devi)\b/,
                        /(sharma|patel|singh|kumar|gupta|agarwal|verma|khan|jain|bansal|mehta|shah|joshi|malhotra|arora|chopra|sinha|saxena|aggarwal|mittal|kapoor|rao|reddy|nair|iyer|menon|pillai|krishnan|raman|swamy|bhat|hegde|kulkarni|desai|gandhi|thakur|pandey|mishra|tiwari|singh|yadav|das|roy|sen|ghosh|mukherjee|chatterjee|bhattacharya|banerjee|dutta|chakraborty|paul|jana|mitra|kar|saha|bose|chandra|dey|lahiri|das|ray|bag|pal|mondal|halder|sarkar|khan|ahmed|ali|hassan|hussain|qureshi|ansari|siddiqui|rizvi|malik|iqbal|shah|shaikh|pathan|syed|zaidi|majumdar)$/,
                        /(esh|ash|ish|osh|ush|ani|ini|oni|uni|ari|eri|ori|uri)$/
                    ]
                },
                // British/English
                'British': {
                    flag: 'üá¨üáß',
                    patterns: [
                        /\b(andrew|matthew|graham|amos|elliott|henry|jason|robert|guy|angela|heather|alison|freda)\b/,
                        /\b(andrew|matthew|heather|alison|freda|angela)\b/,
                        /(smith|jones|taylor|brown|williams|wilson|johnson|davies|evans|thomas|roberts|walker|wright|robinson|thompson|white|hughes|edwards|green|hall|wood|harris|martin|jackson|clarke|clark|lewis|lee|allen|young|king|scott|baker|adams|campbell|anderson|turner|parker|cooper|morris|ward|moore|watson|morgan|bell|murphy|bailey|richardson|cox|howard|ward|torres|peterson|gray|ramirez|james|watson|brooks|kelly|sanders|price|bennett|wood|barnes|ross|henderson|coleman|jenkins|perry|powell|long|patterson|hughes|flores|washington|butler|simmons|foster|gonzales|bryant|alexander|russell|griffin|diaz|hayes)$/
                    ]
                },
                // Finnish
                'Finnish': {
                    flag: 'üá´üáÆ',
                    patterns: [
                        /\b(aki|antti|kai|arto|mikko|samuel)\b/,
                        /\b(aki|antti|arto|mikko)\b/,
                        /(nen|la|inen|m√§ki|koski|niemi|j√§rvi|salo|laine|aho|vuori|harju|peltonen|lehtonen|heikkinen|virtanen|m√§kel√§|korhonen|kinnunen|hakkarainen|lepp√§nen|turunen|rautiainen|pitk√§nen|mattila|r√§is√§nen|saarinen|jokinen|latvala|huhtala|kuusisto|paavola|koskinen)$/,
                        /(nen|la|inen|m√§ki|koski|j√§rvi)$/
                    ]
                },
                // Romanian
                'Romanian': {
                    flag: 'üá∑üá¥',
                    patterns: [
                        /\b(dan|radu|silvana|nicu)\b/,
                        /\b(silvana)\b/,
                        /(escu|eanu|ƒÉ|icƒÉ|oiu|oaie)$/,
                        /\b(alistarh|sebe)\b/
                    ]
                },
                // Portuguese/Brazilian
                'Portuguese': {
                    flag: 'üáµüáπ',
                    patterns: [
                        /\b(arlindo|ricardo)\b/,
                        /(silva|santos|oliveira|souza|rodrigues|ferreira|alves|pereira|lima|gomes|ribeiro|carvalho|castro|costa|pinto|rocha|correia|martins|jesus|soares|fernandes|gon√ßalves|vieira|mendes|cardoso|reis|ramos|machado|freitas|ara√∫jo|lopes|silva|azevedo|monteiro|melo|barbosa|rezende|franco|antunes|fonseca|moura|xavier|miranda|andrade|teixeira|moreira|cunha|henriques|nunes|vasconcelos|faria|borges|s√°|matos|magalh√£es|pacheco|coelho)$/
                    ]
                },
                // Lithuanian
                'Lithuanian': {
                    flag: 'üá±üáπ',
                    patterns: [
                        /\b(indrƒó)\b/,
                        /(ƒó|ienƒó|aitƒó|ytƒó|utƒó|kas|is|us|as)$/
                    ]
                },
                // Spanish
                'Spanish': {
                    flag: 'üá™üá∏',
                    patterns: [
                        /\b(nuria|oliver|isabel|laura)\b/,
                        /(garcia|rodriguez|martinez|lopez|gonzalez|hernandez|perez|sanchez|ramirez|cruz|flores|gomez|morales|vazquez|jimenez|ruiz|diaz|moreno|mu√±oz|alvarez|romero|gutierrez|navarro|torres|dominguez|ramos|serrano|blanco|suarez|molina|castro|ortega|delgado|ortiz|marin|vargas|rubio|iglesias|medina|garrido|santos|cortes|lozano|guerrero|cano|prieto|mendez|calvo|sanz|oliver)$/,
                        /(ez|az|iz|oz|uz|ez|√≥n|√°n|√©n|√≠n|√∫n)$/
                    ]
                },
                // Russian/Slavic
                'Russian': {
                    flag: 'üá∑üá∫',
                    patterns: [
                        /\b(vladimir|alexander|sergei|dmitri|mikhail|ivan|nikolai|pavel|boris|viktor|andrei|alexei|yuri|oleg|anton|roman|maxim|denis|artem|evgeny|konstantin|valentin|stanislav|leonid|fyodor|grigory|anatoly|vasily|arkady|timur|ruslan|ilya|kirill|vadim|gleb|mark|david|daniil|matvei|nikita|ivan|stepan|lev|egor|yan|bogdan|zakhar|arseniy|demyan|platon|savva|tikhon|yarosalv|miroslav|svyatoslav|vsevolod|yaroslav|rostislav|vladislav|vyacheslav)\b/,
                        /\b(anna|maria|elena|natalia|irina|svetlana|olga|tatiana|galina|lyudmila|nadezhda|valentina|larisa|nina|vera|oksana|yulia|ekaterina|anastasia|marina|lyubov|alina|daria|polina|victoria|elizaveta|sofia|varvara|alexandra|arina|vasilisa|kira|milana|eva|yana|ulyana|zlata|amelia|mia|maya|nicole|alisa|diana|valeria|angelina|margarita|kristina|ksenia|evgenia|yekaterina|natalya|lyudmila|raisa|alla|zoya|tamara|rimma|aida|emma|karina|regina|elina|lilia|adelina|sabina|evelina|paulina|albina|elmira|renata|zhanna|inna|rosa|clara|nora|vera|zara|lora|dina|nina|lina|gina|vika|rita|tina|alla|rosa|ella|bella|stella|luna|nova|maya|eva|zara|kira|nora|vera|lara|mira|sara|vera|zara|clara|dara|tara|vara|lera|mera|pera|dera|sera|tera|bera|cera|gera|hera|nera|rera|wera|kera|lera|mera|pera|qera|sera|tera|xera|yera|zera)\b/,
                        /(ov|ova|ev|eva|in|ina|sky|skaya|ich|ovich|ovna|enko|burg|grad|pol|gorod|sk|tsk|vsk|nsk|rsk|lsk|bsk|gsk|hsk|jsk|ksk|msk|psk|ssk|tsk|vsk|wsk|xsk|ysk|zsk)$/,
                        /(ski|skaya|ovich|ovna|enko|burg|grad|pol|gorod)$/
                    ]
                },
                // Japanese
                'Japanese': {
                    flag: 'üáØüáµ',
                    patterns: [
                        /\b(hiroshi|takeshi|kazuhiro|masahiro|yoshihiro|nobuhiro|akira|satoshi|kenjiro|toshiro|yuki|koji|kenji|shinji|ryuji|yuji|hiroyuki|masayuki|kazuyuki|nobuyuki|takayuki|makoto|minoru|tsutomu|osamu|tadashi|isamu|mamoru|susumu|hajime|kaoru|takeru|wataru|satoru|noboru|toru|shigeru|akihiko|yoshihiko|kazuhiko|masahiko|takahiko|naohiko|haruhiko|yasuhiko|mitsuhiko|kunihiko|tomohiko|yukihiko|hidehiko|teruhiko|norihiko|katsuhiko|masahide|yoshiaki|kazuaki|hiroaki|masaaki|takaaki|chiaki|naoaki|tomoaki|hideaki|kimitaka|yoshitaka|masataka|hirotaka|kazutaka|naotaka|tomotaka|hidetaka|nobutaka|katsutaka|mitsutaka|yutaka|toshiaki|nobuaki|katsuaki|mitsuaki|tomoaki|hideaki|yoshiaki|masaaki|hiroaki|kazuaki|takaaki|naoaki|chiaki|yukiaki|teruyuki|nobuyuki|masayuki|hiroyuki|kazuyuki|takayuki|naoyuki|tomoyuki|hideyuki|katsuyuki|mitsuyuki|toshiyuki|akiyuki|yoshiyuki|haruyuki|yasuyuki|noriyuki|kuniyuki|yutaka|yuki|koji|kenji|shinji|ryuji|yuji|hiroshi|satoshi|takeshi|kazuhiro|masahiro|yoshihiro|nobuhiro|akira|kenjiro|toshiro)\b/,
                        /\b(yuki|akiko|keiko|naoko|yoko|kumiko|sachiko|michiko|emiko|yukiko|noriko|mariko|hiroko|kazuko|masako|takako|hanako|fumiko|tomoko|kyoko|reiko|shizuko|yasuko|chieko|hideko|teruko|haruko|kazue|masae|takae|hanae|fumie|tomoe|kyoe|reie|shizue|yasue|chie|hide|teru|haru|kazu|masa|taka|hana|fumi|tomo|kyo|rei|shizu|yasu|chi|hid|ter|har|kaz|mas|tak|han|fum|tom|ky|re|shi|yas|ch|hi|te|ha|ka|ma|ta|ha|fu|to|ky|re|sh|ya|ch)\b/,
                        /(moto|mura|yama|kawa|sawa|hara|wara|naka|tani|gawa|zawa|shima|jima|uchi|guchi|buchi|fuchi|kuchi|muchi|nuchi|ruchi|suchi|tuchi|yuchi|zuchi|ishi|bashi|gashi|hashi|kashi|mashi|nashi|rashi|sashi|tashi|yashi|zashi|da|ta|da|na|ba|ha|ma|ya|ra|sa|wa|ka|ga|za|ji|shi|chi|ni|hi|mi|ri|ki|gi|zi|zu|su|tsu|nu|hu|mu|yu|ru|ku|gu|zu)$/,
                        /(san|chan|kun|sama|senpai|sensei|shi|ko|mi|ka|na|ri|yu|ma|sa|ki|to|no|ha|hi)$/
                    ]
                },
                // Korean
                'Korean': {
                    flag: 'üá∞üá∑',
                    patterns: [
                        /\b(kim|lee|park|choi|jung|kang|cho|yoon|jang|lim|han|oh|seo|shin|kwon|hwang|ahn|song|yoo|hong|jeon|go|moon|yang|baek|heo|nam|min|noh|ji|woo|ryu|kim|lee|park|choi|jung|kang|cho|yoon|jang|lim)\b/,
                        /\b(seung|min|jun|ho|woo|jin|hyun|young|ki|soo|dong|sang|myung|sun|kyung|hee|ja|ok|soon|mi|ae|eun|bo|ra|na|da|ga|ha|ma|sa|ba|pa|ta|ka|wa|ya|la|cha|ja|za)\b/,
                        /(kim|lee|park|choi|jung|kang|cho|yoon|jang|lim|han|oh|seo|shin|kwon|hwang|ahn|song|yoo|hong|jeon|go|moon|yang|baek|heo|nam|min|noh|ji|woo|ryu)$/,
                        /(seung|hyun|young|kyung|hoon|sung|jin|min|jun|ho|woo|ki|soo|dong|sang|myung|sun|hee|ja|ok|soon|mi|ae|eun)$/
                    ]
                },
                // Vietnamese
                'Vietnamese': {
                    flag: 'üáªüá≥',
                    patterns: [
                        /\b(nguyen|tran|le|pham|hoang|phan|vu|dang|bui|do|ho|ngo|duong|ly|mai|truong|thai|tang|lam|cao|vo|ta|trinh|dao|ong|bach|dinh|ha|lieu|cu|phung|huynh|tieu|ky|tu|luu|son|hoa|phu|ma|hau|cao|doan|cao|luu|son|hoa|phu|ma|hau|cao|doan)\b/,
                        /\b(anh|minh|duc|hai|huy|nam|quan|thang|tuan|vinh|hung|long|khang|phong|hieu|kien|duy|dat|bao|khoa|phat|tai|thinh|tin|tri|an|binh|cuong|dung|giang|ha|hao|hieu|hoa|hoang|huy|khanh|khoa|lam|linh|loc|long|luong|manh|minh|nam|nghia|nhan|phong|phuc|quan|quang|son|tai|tam|tan|thanh|thang|thinh|thong|tien|tin|toan|tuan|tung|uy|vinh|vu|xuan|yen)\b/,
                        /(nguyen|tran|le|pham|hoang|phan|vu|dang|bui|do|ho|ngo|duong|ly|mai|truong|thai|tang|lam|cao|vo|ta|trinh|dao|ong|bach|dinh|ha|lieu|cu|phung|huynh|tieu|ky|tu|luu|son|hoa|phu|ma|hau|cao|doan)$/
                    ]
                },
                // Azerbaijani/Central Asian
                'Azerbaijani': {
                    flag: 'üá¶üáø',
                    patterns: [
                        /\b(azerbaijan|baku|azeri|azerbaijani)\b/,
                        /(ov|ova|ev|eva|zade|zadeh|oglu|oghlu|ali|bey|khan)$/,
                        /(aliyev|mammadov|hasanov|huseynov|gasimov|ismayilov|abdullayev|rahimov|karimov|musayev)$/
                    ]
                },
                // Serbian
                'Serbian': {
                    flag: 'üá∑üá∏',
                    patterns: [
                        /\b(ilija|bogunovic|natasa|przulj)\b/,
                        /\b(milos|marko|stefan|nikola|vladimir|aleksandar|nenad|dragan|zoran|goran|predrag|miroslav|slobodan|dusan|milan|branko|radovan|rajko|dejan|srdjan|bojan|darko|dalibor|miljan|jovana|ana|marija|jelena|milica|tamara|sandra|danijela|jasmina|vesna|snezana|ljiljana|gordana|zorica|radmila|slavica|dragana|milka|biljana|nada|mira)\b/,
                        /(ovic|evic|ic|ac|ek|ak|ov|ev|in|an|on|en|un)$/
                    ]
                },
                // Hungarian
                'Hungarian': {
                    flag: 'üá≠üá∫',
                    patterns: [
                        /\b(gergely|neu)\b/,
                        /\b(ferenc|janos|istvan|laszlo|sandor|zoltan|geza|attila|tibor|bela|mihaly|gabor|peter|andras|gyorgy|imre|karoly|jozsef|adam|balazs|daniel|mate|zsolt|roland|agnes|maria|eva|katalin|erzsebet|margit|judit|andrea|krisztina|aniko|gabriella|zsuzsanna|monika|beata|emese|orsolya|eszter|dora|petra|rita|tunde|edit|ilona|klara|reka|nora|kinga|viktoria|anita|timea|bernadett|szilvia|melinda|brigitta|renata|csilla|henrietta)\b/,
                        /(nagy|kovacs|toth|szabo|horvath|varga|kiss|molnar|nemeth|farkas|balogh|papp|takacs|juhasz|lakatos|meszaros|olah|simon|racz|fekete|szucs|kerekes|halasz|lengyel|szalai|boros|kelemen|magyar|gal|koncz|Urban|muller|katona|jakab|bogdan|bacso|gonczi|feher|torok|adam|balog|somogyi|pap|orosz|lukacs|poor|nagy|farkass|balazs|csapo|kocsis|kiraly|sari|biro|gulyas|barta|fodor|kosa|pal|pataki|antal|pentek|fulop|vass|banki|dobos|vegh|sebestyen|veres|varga|zoltan|csonka|hegyi|rozsa|solyom|fulop|benke|berki|huszar|zentai|szocs|bango|szilagyi|fabian)$/,
                        /(fy|ny|gy|ty|ly|sz|cs|zs|dz|dzs)$/
                    ]
                },
                // Thai
                'Thai': {
                    flag: 'üáπüá≠',
                    patterns: [
                        /\b(krikamol|muandet)\b/,
                        /\b(somchai|somsak|surasak|surachai|sombat|siriporn|siriluck|siriwan|sunisa|supaporn|suwannee|pensri|pranee|porntip|ratana|ratchanee|sawittree|siripat|sukanya|sumitra|sumontha|anan|anand|aphichat|apirak|arin|arun|charoen|chatri|chuay|danai|jirawat|kamon|kamol|kiet|komsan|kriangsak|manit|niran|nithi|nopporn|paiboon|paisal|pakorn|patiparn|phairat|phanuwat|pichet|piyapat|pongsak|praphan|preecha|pricha|rachata|rawin|samart|sanguan|sanya|sarawut|sathit|sawai|sirichai|somnuk|songkran|sriphan|subin|suchart|sudjai|sukit|sumet|suphot|surachart|suraphon|surasak|suriya|suwan|thana|thani|thanin|thanom|thawatchai|theeraphong|thiti|udom|viroj|visanu|walai|wanchai|weerawat|wicha|wichian|wichit|wira|wirat|wisan|yongyuth)\b/,
                        /(chai|wong|sri|porn|wut|kit|sit|nat|rat|wat|san|som|sun|cha|pha|tha|kan|kam|ran|wan|sak|nan|tan|pan|man|ban|han|gan|lan|yan|dan)$/
                    ]
                },
                // Syrian
                'Syrian': {
                    flag: 'üá∏üáæ',
                    patterns: [
                        /\b(dima|damen)\b/,
                        /\b(ahmad|ahmed|ali|mohammed|omar|hassan|hussein|khalil|said|yusuf|ibrahim|ismail|mahmoud|abdul|abdel|walid|rami|sami|tariq|fadi|ghassan|mazen|nizar|osama|riad|samir|wael|ziad|fatima|amal|layla|nour|reem|sara|dina|lina|rana|rita|maya|nada|rania|hala|mona|nora|yara|zara|mariam|ghada|rula|salam|widad|yasmin|zahra|amina|asma|dalal|farah|hanan|iman|khadija|lamia|maha|najla|rasha|sahar|wafa|zeina)\b/,
                        /(al|el|abu|bin|ibn|assad|damascus|aleppo|homs|latakia|tartus|deir|raqqa|hasaka|idlib|daraya|douma|ghouta)$/
                    ]
                },
                // Czech
                'Czech': {
                    flag: 'üá®üáø',
                    patterns: [
                        /\b(josef|sivic)\b/,
                        /\b(jan|petr|pavel|tomas|martin|david|michal|jakub|lukas|adam|ondrej|milan|jiri|karel|stanislav|vladimir|frantisek|josef|vaclav|zdenek|jaroslav|oldrich|ladislav|ales|roman|robert|marek|daniel|richard|patrik|dominik|anna|marie|jana|eva|hana|lenka|katerina|alena|vera|zuzana|barbora|tereza|petra|veronika|jana|ivana|martina|jitka|helena|michaela|marketa|andrea|ludmila|kristyna|sarka|jarmila|marie|stanislava|dana|milada|libuse|bozena|anna|vlasta|frantiska|marie|irena|marie|olga|ruzena|marie|anezka|marie|jaroslava|marie|alzbeta|marie)\b/,
                        /(ova|ek|ak|ik|yk|nova|kova|ova|ska|cka|ny|ky|ty|ly|ry|sy|vy|zy|hy|my|py|dy|fy|gy|by|cy|chy|shy|thy|zhy|phy|ghy|why|khy|lhy|rhy|shy|thy|vhy|zhy|chy|dhy|fhy|ghy|jhy|khy|mhy|nhy|phy|rhy|shy|thy|vhy|why|xhy|yhy|zhy)$/,
                        /(novak|svoboda|novotny|dvorak|cerny|prochazka|krejci|havlova|horacek|jerabek|kolar|nemec|pokorny|pospisil|reznicek|ruzicka|simek|stanek|stepan|travnicek|urban|vesely|vlcek|vorlicek|wagner|zeman|fiala|hajek|holub|horak|jelinek|kafka|kopecky|kratochvil|krejcova|kriz|kucera|marek|musil|navratil|nedved|pavelka|pesek|pich|polak|popelka|richter|sedlacek|skala|slaby|smid|sokol|spacek|spurny|sykora|tomek|turek|vacek|valenta|vavra|vesely|vitek|vlach|vortek|zahradnik|zak|zima)$/
                    ]
                },
                // Israeli
                'Israeli': {
                    flag: 'üáÆüá±',
                    patterns: [
                        /\b(sagie|benaim|or|litany)\b/,
                        /\b(avi|david|yosef|michael|daniel|ron|amit|alex|eitan|guy|tal|lior|roi|yaron|gal|oren|asaf|amir|shay|dor|itay|noam|idan|yonatan|nir|omer|shai|tomer|maya|noa|shira|yael|michal|hila|dana|sharon|roni|liat|rinat|merav|sigal|einat|keren|osnat|miri|efrat|iris|dorit|limor|yifat|orna|sarit|ronit|tal|chen|galia|orly|inbal|adi|noy|maayan|mor|shani|karin|tali|gila|liora|malka|ruth|esther|naomi|sarah|rachel|leah|miriam|rebecca|judith|deborah|hannah|abigail|elizabeth|mary)\b/,
                        /(berg|stein|man|cohen|levy|mizrahi|peretz|biton|dahan|avraham|friedman|katz|israeli|goldberg|rosenberg|shapiro|weiss|klein|rosen|schwartz|ben|bar|zur|gal|paz|nir|tal|ron|guy|roy|lev|mor|raz|dan|gil|or|ad|el|zvi|hai|dor|alon|erez|gadi|ilan|yair|boaz|yuval|ehud|rami|ari|dov|moshe|yehuda|shlomo|abraham|isaac|jacob|samuel|benjamin|joseph|aaron|caleb|joshua|nathan|simon|adam|noah|amos|ezra|isaiah|jonah|micah|uri|gideon|ariel|omri|roee|liam|ethan|elias|ori|nevo|sela|carmi|porat|shamir|navon|keren|dagan|harari|shaked|segev|sapir|regev|azoulay|malka|sabbag|swissa|ohana|moyal|elbaz|bouzaglo|ben|bar|israeli|jerusalem|tel|aviv|haifa|eilat|netanya|ashdod|rishon|lezion|petah|tikva|holon|bnei|brak|ramat|gan|ashkelon|bat|yam|kfar|saba|herzliya|modiin|nazareth|akko|tiberias|safed)$/
                    ]
                },
                // Iranian/Persian
                'Iranian': {
                    flag: 'üáÆüá∑',
                    patterns: [
                        /\b(nassir|navab)\b/,
                        /\b(ali|hassan|mohammed|ahmad|reza|mohammad|mehdi|hossein|amir|abbas|hamid|majid|saeed|javad|masoud|nasser|farid|karim|omid|babak|darius|cyrus|kourosh|rostam|arash|shahram|behrouz|farhad|kamran|keyvan|peyman|siavash|vahid|yashar|maryam|fatima|zahra|nasrin|soraya|shirin|golnar|laleh|setareh|bahar|niloufar|roya|sara|samira|sima|vida|ziba|azadeh zamanpour|gholi|karimi|hosseini|ahmadi|mohammadi|rahmani|moradi|salehi|khodadadi|ghasemi|hajati|shirzad|shirani|nazemi|nabavi|tavakoli|jafari|mirzaei|rostami|zare|hatami|abbasi|mousavi|kazemi|sohrabi|sharifi|tabrizi|esfahani|mashhadi|tehrani|shirazi|yazdi|ardabili|gilani|mazandarani|golestani|qomi|bojnordi|sabzevar)$/,
                        /(pour|zadeh|ian|nia|rad|far|mehr|shah|abad|bad|bod|gah|kuh|rud|sar|var|zar|jer|kes|kan|gan|tan|pan|ban|han|wan|ran|jan|man|san|dan|fan|lan|van|gol|kol|nol|rol|sol|tol|vol|pol|fol|jol|mol|hol|dol|bol|lol|yol|xol|zol|wol|qol|kol|gol|fol|eol|iol|uol|aol|ool)$/
                    ]
                }
            };

            // Check each nationality pattern
            for (const [nationality, data] of Object.entries(patterns)) {
                for (const pattern of data.patterns) {
                    if (pattern.test(nameLower)) {
                        return { nationality, flag: data.flag };
                    }
                }
            }

            // Enhanced fallback detection
            
            // Check for accented/special characters (European)
            if (/[√†√°√¢√£√§√•√¶√ß√®√©√™√´√¨√≠√Æ√Ø√∞√±√≤√≥√¥√µ√∂√∏√π√∫√ª√º√Ω√æ√ø≈üƒüƒ±√∂√ºƒáƒçƒë≈°≈æƒÖƒô≈Ç≈Ñ√≥≈õ≈∫≈º≈à≈ô≈•≈Øƒõƒèƒæƒ∫≈ïƒç≈•≈°≈æ√Ω√°√≠√©√≥√∫≈Ø√§√∂√º√ü√±√ß]/.test(nameLower)) {
                return { nationality: 'European', flag: 'üá™üá∫' };
            }
            
            // Check for common Western patterns
            if (/\b(dr|prof|professor|phd|md|mr|mrs|ms|miss)\b/.test(nameLower)) {
                return { nationality: 'Western', flag: 'üåç' };
            }
            
            // Check for university/academic affiliations in name
            if (/\b(university|college|institute|tech|stanford|mit|harvard|cambridge|oxford|eth|cmu|ucla|usc|nyu|princeton|yale|cornell|columbia|penn|brown|dartmouth|duke|chicago|northwestern|vanderbilt|rice|notre dame|georgetown|wake forest|tufts|boston|northeastern|emory|tulane|washington|wisconsin|michigan|illinois|indiana|ohio|purdue|iowa|minnesota|nebraska|kansas|missouri|arkansas|alabama|auburn|georgia|florida|tennessee|kentucky|virginia|north carolina|south carolina|texas|oklahoma|colorado|utah|arizona|nevada|oregon|washington|california|berkeley|davis|irvine|san diego|santa barbara|riverside|merced|fresno|northridge|fullerton|long beach|pomona|san bernardino|san francisco|san jose|san luis obispo|santa cruz|santa clara|san marcos|channel islands|dominguez hills|east bay|monterey bay|sacramento|sonoma|stanislaus|bakersfield|chico|humboldt|san francisco state|sorbonne|max planck|cnrs|inria|cea|inserm|pasteur|curie|ecole|polytechnique|normale|mines|centrale|supelec|telecom|ensta|ensae|ensai|enpc|ponts|paristech|psl|sorbonne|sciences po)\b/.test(nameLower)) {
                return { nationality: 'Academic', flag: 'üéì' };
            }
            
            // Check for common international patterns
            if (/\b(international|global|worldwide|multinational)\b/.test(nameLower)) {
                return { nationality: 'International', flag: 'üåç' };
            }
            
            // Length-based heuristics
            if (nameLower.length > 20) {
                return { nationality: 'Compound/International', flag: 'üåê' };
            }
            
            // Very short names often Western
            if (nameLower.length < 6 && /^[a-z\s]+$/.test(nameLower)) {
                return { nationality: 'Western', flag: 'üåç' };
            }
            
            // Names with lots of consonants - possibly Slavic/Eastern European
            const consonants = (nameLower.match(/[bcdfghjklmnpqrstvwxyz]/g) || []).length;
            const vowels = (nameLower.match(/[aeiou]/g) || []).length;
            if (consonants > vowels * 2) {
                return { nationality: 'Eastern European', flag: 'üá™üá∫' };
            }
            
            // Names ending in common patterns
            if (/\b\w+(son|sen|ton|burg|berg|heim|stein|feld|thal|bach|hof|dorf|mann|owski|inski|enko|ovich|ovna|escu|oiu|sson|sen|gren|holm|lund|strand|kvist)$/.test(nameLower)) {
                return { nationality: 'European', flag: 'üá™üá∫' };
            }
            
            return { nationality: 'Unknown', flag: 'üåç' };
        }

        // Copy name to clipboard function
        async function copyNameToClipboard(name, element) {
            try {
                await navigator.clipboard.writeText(name);
                
                // Visual feedback
                element.classList.add('copy-feedback');
                const originalText = element.innerHTML;
                element.innerHTML = `üìã Copied: ${name}`;
                
                setTimeout(() => {
                    element.classList.remove('copy-feedback');
                    element.innerHTML = originalText;
                }, 1500);
                
            } catch (err) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = name;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                // Visual feedback for fallback
                element.classList.add('copy-feedback');
                const originalText = element.innerHTML;
                element.innerHTML = `üìã Copied: ${name}`;
                
                setTimeout(() => {
                    element.classList.remove('copy-feedback');
                    element.innerHTML = originalText;
                }, 1500);
            }
        }

        // Nationality override storage
        let nationalityOverrides = JSON.parse(localStorage.getItem('nationalityOverrides') || '{}');

        // Show nationality selector modal
        function showNationalitySelector(name) {
            const availableNationalities = [
                { name: 'German', flag: 'üá©üá™' },
                { name: 'Italian', flag: 'üáÆüáπ' },
                { name: 'French', flag: 'üá´üá∑' },
                { name: 'Arabic/Middle Eastern', flag: 'üá∏üá¶' },
                { name: 'Chinese', flag: 'üá®üá≥' },
                { name: 'Scandinavian', flag: 'üá∏üá™' },
                { name: 'Dutch', flag: 'üá≥üá±' },
                { name: 'Polish', flag: 'üáµüá±' },
                { name: 'Greek', flag: 'üá¨üá∑' },
                { name: 'Turkish', flag: 'üáπüá∑' },
                { name: 'Indian', flag: 'üáÆüá≥' },
                { name: 'British', flag: 'üá¨üáß' },
                { name: 'Finnish', flag: 'üá´üáÆ' },
                { name: 'Romanian', flag: 'üá∑üá¥' },
                { name: 'Portuguese', flag: 'üáµüáπ' },
                { name: 'Lithuanian', flag: 'üá±üáπ' },
                { name: 'Spanish', flag: 'üá™üá∏' },
                { name: 'Russian', flag: 'üá∑üá∫' },
                { name: 'Japanese', flag: 'üáØüáµ' },
                { name: 'Korean', flag: 'üá∞üá∑' },
                { name: 'Vietnamese', flag: 'üáªüá≥' },
                { name: 'Azerbaijani', flag: 'üá¶üáø' },
                { name: 'Serbian', flag: 'üá∑üá∏' },
                { name: 'Hungarian', flag: 'üá≠üá∫' },
                { name: 'Thai', flag: 'üáπüá≠' },
                { name: 'Syrian', flag: 'üá∏üáæ' },
                { name: 'Czech', flag: 'üá®üáø' },
                { name: 'Israeli', flag: 'üáÆüá±' },
                { name: 'Iranian', flag: 'üáÆüá∑' },
                { name: 'European', flag: 'üá™üá∫' },
                { name: 'Western', flag: 'üåç' },
                { name: 'Academic', flag: 'üéì' },
                { name: 'International', flag: 'üåê' }
            ];

            // Create modal overlay
            const overlay = document.createElement('div');
            overlay.className = 'modal-overlay';
            overlay.onclick = () => closeNationalitySelector();

            // Create selector dialog
            const selector = document.createElement('div');
            selector.className = 'nationality-selector';
            selector.innerHTML = `
                <h3>Set nationality for: ${name}</h3>
                ${availableNationalities.map(nat => 
                    `<button class="nationality-option" onclick="setNationality('${name}', '${nat.name}', '${nat.flag}')">
                        ${nat.flag} ${nat.name}
                    </button>`
                ).join('')}
                <button class="nationality-option" onclick="closeNationalitySelector()" style="background: #f44336; color: white; margin-top: 10px;">
                    ‚ùå Cancel
                </button>
            `;

            document.body.appendChild(overlay);
            document.body.appendChild(selector);
        }

        // Set nationality for a name
        function setNationality(name, nationality, flag) {
            nationalityOverrides[name] = { nationality, flag };
            localStorage.setItem('nationalityOverrides', JSON.stringify(nationalityOverrides));
            closeNationalitySelector();
            displayNames(); // Refresh the display
        }

        // Close nationality selector
        function closeNationalitySelector() {
            const overlay = document.querySelector('.modal-overlay');
            const selector = document.querySelector('.nationality-selector');
            if (overlay) overlay.remove();
            if (selector) selector.remove();
        }

        // Enhanced guessNationality function with override support
        function guessNationalityWithOverride(name) {
            // Check for manual override first
            if (nationalityOverrides[name]) {
                return nationalityOverrides[name];
            }
            
            // Use original function
            return guessNationality(name);
        }

        // Analyze unknown names and show suggestions
        function analyzeUnknownNames() {
            const unknownNames = names.filter(name => {
                const nationality = guessNationalityWithOverride(name);
                return nationality.nationality === 'Unknown';
            });

            if (unknownNames.length === 0) {
                alert('Great! No unknown names found. All names have been successfully categorized.');
                return;
            }

            const analysisResults = unknownNames.map(name => {
                const suggestions = generateNationalitySuggestions(name);
                return { name, suggestions };
            });

            showUnknownNamesAnalysis(analysisResults);
        }

        // Generate nationality suggestions based on enhanced patterns
        function generateNationalitySuggestions(name) {
            const nameLower = name.toLowerCase();
            const suggestions = [];

            // Check for specific patterns that might indicate nationality
            
            // Multiple word names (often Western)
            if (name.split(' ').length > 2) {
                suggestions.push({ nationality: 'Western', flag: 'üåç', reason: 'Multiple words suggest Western naming convention' });
            }

            // Names with apostrophes (often Irish/Celtic)
            if (name.includes("'") || /o'|mc/.test(nameLower)) {
                suggestions.push({ nationality: 'British', flag: 'üá¨üáß', reason: 'Contains Celtic naming patterns (O\', Mc)' });
            }

            // Names with hyphens (often German/European)
            if (name.includes('-')) {
                suggestions.push({ nationality: 'German', flag: 'üá©üá™', reason: 'Hyphenated names common in German naming' });
            }

            // Academic titles might suggest Western academia
            if (/\b(prof|dr|professor|phd)\b/i.test(name)) {
                suggestions.push({ nationality: 'Academic', flag: 'üéì', reason: 'Contains academic title' });
            }

            // Single character initials (often Western)
            if (/\b[A-Z]\b/.test(name)) {
                suggestions.push({ nationality: 'Western', flag: 'üåç', reason: 'Contains single-letter initials (Western style)' });
            }

            // Very long names might be compound/international
            if (name.length > 25) {
                suggestions.push({ nationality: 'International', flag: 'üåê', reason: 'Very long name suggests compound/international origin' });
            }

            // Default suggestion
            if (suggestions.length === 0) {
                suggestions.push({ nationality: 'European', flag: 'üá™üá∫', reason: 'No clear patterns detected, likely European' });
            }

            return suggestions.slice(0, 3); // Return top 3 suggestions
        }

        // Show unknown names analysis dialog
        function showUnknownNamesAnalysis(analysisResults) {
            const overlay = document.createElement('div');
            overlay.className = 'modal-overlay';
            overlay.onclick = () => closeUnknownAnalysis();

            const dialog = document.createElement('div');
            dialog.className = 'nationality-selector';
            dialog.style.maxWidth = '600px';
            dialog.style.maxHeight = '80vh';
            
            const unknownCount = analysisResults.length;
            dialog.innerHTML = `
                <h3>üîç Unknown Names Analysis (${unknownCount} names found)</h3>
                <p>Here are names that couldn't be automatically categorized with suggested nationalities:</p>
                <div style="max-height: 400px; overflow-y: auto;">
                    ${analysisResults.map((result, index) => `
                        <div style="border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 8px; background: #f9f9f9;">
                            <h4 style="margin: 0 0 10px 0; color: #333;">${index + 1}. ${result.name}</h4>
                            <div style="margin-left: 20px;">
                                ${result.suggestions.map((suggestion, idx) => `
                                    <button class="nationality-option" onclick="setNationality('${result.name}', '${suggestion.nationality}', '${suggestion.flag}')" 
                                            style="margin: 3px 0; font-size: 12px; padding: 6px 10px;">
                                        ${suggestion.flag} ${suggestion.nationality}
                                        <br><small style="color: #666; font-style: italic;">${suggestion.reason}</small>
                                    </button>
                                `).join('')}
                                <button class="nationality-option" onclick="showNationalitySelector('${result.name}')" 
                                        style="background: #007bff; color: white; margin: 3px 0; font-size: 12px; padding: 6px 10px;">
                                    üè≥Ô∏è Choose Different
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
                    <button class="nationality-option" onclick="closeUnknownAnalysis()" 
                            style="background: #6c757d; color: white; width: 100%;">
                        Close Analysis
                    </button>
                </div>
            `;

            document.body.appendChild(overlay);
            document.body.appendChild(dialog);
        }

        // Close unknown names analysis
        function closeUnknownAnalysis() {
            const overlay = document.querySelector('.modal-overlay');
            const dialog = document.querySelector('.nationality-selector');
            if (overlay) overlay.remove();
            if (dialog) dialog.remove();
        }

        // Test specific names from the table
        function testTableNames() {
            const testNames = [
                'Dan Alistarh',
                'Serge Belongie', 
                'Sagie Benaim',
                'Hakan Bilen',
                'Ilija Bogunovic',
                'Esra Bulbul',
                'Dima Damen',
                'Nicolas Flammarion',
                'Gergely Neu',
                'Nuria Oliver',
                'Nassir Navab',
                'Nicu Sebe',
                'Josef Sivic',
                'Renjie Liao',
                'Or Litany',
                'Rupak Majumdar',
                'Krikamol Muandet',
                'Natasa Przulj',
                'Rosanne Rademaker',
                'Sofie Valk'
            ];

            const results = testNames.map(name => {
                const nationality = guessNationalityWithOverride(name);
                return { name, nationality: nationality.nationality, flag: nationality.flag };
            });

            const overlay = document.createElement('div');
            overlay.className = 'modal-overlay';
            overlay.onclick = () => closeTestResults();

            const dialog = document.createElement('div');
            dialog.className = 'nationality-selector';
            dialog.style.maxWidth = '700px';
            dialog.style.maxHeight = '80vh';
            
            dialog.innerHTML = `
                <h3>üß™ Table Names Detection Test</h3>
                <p>Testing nationality detection for names from your research table:</p>
                <div style="max-height: 400px; overflow-y: auto;">
                    ${results.map((result, index) => `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 5px; background: ${result.nationality === 'Unknown' ? '#ffebee' : '#e8f5e8'};">
                            <span style="font-weight: bold;">${result.name}</span>
                            <span>${result.flag} ${result.nationality}</span>
                        </div>
                    `).join('')}
                </div>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
                    <p style="margin: 0; font-size: 14px; color: #666;">
                        ‚úÖ Green = Detected | ‚ùå Red = Still Unknown
                    </p>
                    <button class="nationality-option" onclick="closeTestResults()" 
                            style="background: #6c757d; color: white; width: 100%; margin-top: 10px;">
                        Close Test Results
                    </button>
                </div>
            `;

            document.body.appendChild(overlay);
            document.body.appendChild(dialog);
        }

        // Close test results
        function closeTestResults() {
            const overlay = document.querySelector('.modal-overlay');
            const dialog = document.querySelector('.nationality-selector');
            if (overlay) overlay.remove();
            if (dialog) dialog.remove();
        }

        // Auto-link conversion function
        function convertLinksToClickable(text) {
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            return text.replace(urlRegex, '<a href="$1" target="_blank">$1</a>');
        }

        function autoLinkDetection(textarea) {
            const text = textarea.value;
            const cursorPos = textarea.selectionStart;
            const textBeforeCursor = text.substring(0, cursorPos);
            const lastWord = textBeforeCursor.split(/\s/).pop();
            
            // Check if the last word before cursor is a URL
            const urlRegex = /^https?:\/\/[^\s]+$/;
            if (urlRegex.test(lastWord)) {
                // Add visual feedback that link was detected
                textarea.style.backgroundColor = '#e8f5e8';
                setTimeout(() => {
                    textarea.style.backgroundColor = '';
                }, 500);
            }
        }

        // Memory system using localStorage
        class NotesMemory {
            constructor() {
                this.storageKey = 'names-notes';
                this.notes = this.loadNotes();
            }

            loadNotes() {
                try {
                    const stored = localStorage.getItem(this.storageKey);
                    return stored ? JSON.parse(stored) : {};
                } catch (error) {
                    console.error('Error loading notes:', error);
                    return {};
                }
            }

            saveNotes() {
                try {
                    localStorage.setItem(this.storageKey, JSON.stringify(this.notes));
                } catch (error) {
                    console.error('Error saving notes:', error);
                }
            }

            getNote(name) {
                return this.notes[name] || '';
            }

            setNote(name, note) {
                if (note.trim()) {
                    this.notes[name] = note.trim();
                } else {
                    delete this.notes[name];
                }
                this.saveNotes();
            }

            hasNote(name) {
                return this.notes.hasOwnProperty(name) && this.notes[name].trim() !== '';
            }

            getAllNotesCount() {
                return Object.keys(this.notes).length;
            }
        }

        // Initialize memory system
        const notesMemory = new NotesMemory();
        let filteredNames = [...names];
        
        // Recommended PhD supervisors (top 10 based on academic prominence)
        const recommendedSupervisors = [
            "Bernhard Sch√∂lkopf",
            "Daniel Cremers", 
            "Thomas Brox",
            "Zeynep Akata",
            "Frank Hutter",
            "Matthias Niessner",
            "Bernt Schiele",
            "Stefan Roth",
            "Andreas Bulling",
            "Juergen Gall"
        ];
        
        // PhD selection management
        let selectedPhdCandidates = JSON.parse(localStorage.getItem('phd-selections') || '[]');
        
        function updatePhdCounter() {
            document.getElementById('phdCounter').textContent = `${selectedPhdCandidates.length}/10 selected`;
        }
        
        function togglePhdSelection(name) {
            const index = selectedPhdCandidates.indexOf(name);
            if (index > -1) {
                selectedPhdCandidates.splice(index, 1);
            } else if (selectedPhdCandidates.length < 10) {
                selectedPhdCandidates.push(name);
            } else {
                alert('You can only select up to 10 PhD supervisors!');
                // Uncheck the checkbox since we're not adding it
                const checkbox = document.querySelector(`input[onchange="togglePhdSelection('${name}')"]`);
                if (checkbox) checkbox.checked = false;
                return;
            }
            
            localStorage.setItem('phd-selections', JSON.stringify(selectedPhdCandidates));
            updatePhdCounter();
            
            // Only update the visual state of this specific item, don't rebuild entire list
            updateItemVisualState(name);
        }
        
        function updateItemVisualState(name) {
            const nameItem = document.querySelector(`div[data-name="${name}"]`);
            if (nameItem) {
                const isSelected = selectedPhdCandidates.includes(name);
                if (isSelected) {
                    nameItem.classList.add('phd-selected');
                } else {
                    nameItem.classList.remove('phd-selected');
                }
            }
        }
        
        function showSelectedList() {
            if (selectedPhdCandidates.length === 0) {
                alert('No PhD supervisors selected yet!');
                return;
            }
            
            const list = selectedPhdCandidates.map((name, index) => `${index + 1}. ${name}`).join('\n');
            alert(`Selected PhD Supervisors (${selectedPhdCandidates.length}/10):\n\n${list}`);
        }
        
        function clearAllSelections() {
            if (confirm('Are you sure you want to clear all PhD supervisor selections?')) {
                selectedPhdCandidates = [];
                localStorage.setItem('phd-selections', JSON.stringify(selectedPhdCandidates));
                updatePhdCounter();
                populateNamesList();
            }
        }

        // Create name item HTML
        function createNameItem(name, index) {
            const hasNote = notesMemory.hasNote(name);
            const note = notesMemory.getNote(name);
            const nationality = guessNationalityWithOverride(name);
            const isRecommended = recommendedSupervisors.includes(name);
            const isSelected = selectedPhdCandidates.includes(name);
            const nameId = `name-${index}`;
            const noteWithLinks = convertLinksToClickable(note);
            
            return `
                <div class="name-item ${isSelected ? 'phd-selected' : ''}" data-name="${name}" id="${nameId}">
                    <div class="name-header">
                        <span class="name-text">
                            ${index + 1}. 
                            <span class="nationality-flag">${nationality.flag}</span>
                            <span class="clickable-name" onclick="copyNameToClipboard('${name}', this)" title="Click to copy name">${name}</span>
                            <span class="nationality-text">${nationality.nationality}</span>
                            ${nationality.nationality === 'Unknown' ? `<button class="nationality-override-btn" onclick="showNationalitySelector('${name}')" title="Set nationality">üè≥Ô∏è</button>` : ''}
                            ${isRecommended ? '<span class="recommended-badge">‚≠ê TOP</span>' : ''}
                        </span>
                        <div>
                            <span class="phd-selector">
                                <input type="checkbox" class="phd-checkbox" ${isSelected ? 'checked' : ''} 
                                       data-name="${name}" />
                                <label>PhD Candidate</label>
                            </span>
                            <button class="note-toggle ${hasNote ? 'has-note' : ''}" data-name="${name}">
                                ${hasNote ? 'üìù Edit Note' : '‚ûï Add Note'}
                            </button>
                        </div>
                    </div>
                    <div class="note-section" data-name="${name}">
                        <div class="note-display ${hasNote ? 'active' : ''}" data-name="${name}">${noteWithLinks}</div>
                        <textarea class="note-textarea" placeholder="Add your notes about ${name}... (URLs will become clickable links)" data-name="${name}">${note}</textarea>
                        <div class="note-actions">
                            <button class="save-note" data-name="${name}">Save</button>
                            <button class="clear-note" data-name="${name}">Clear</button>
                            <button class="edit-toggle" data-name="${name}">Edit</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Search and filter functionality
        function filterNames() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filterType = document.getElementById('filterSelect').value;
            const countryFilter = document.getElementById('countryFilter').value;
            
            filteredNames = names.filter(name => {
                const matchesSearch = name.toLowerCase().includes(searchTerm);
                const hasNote = notesMemory.hasNote(name);
                const isSelected = selectedPhdCandidates.includes(name);
                const nationality = guessNationalityWithOverride(name).nationality;
                
                let matchesFilter = true;
                if (filterType === 'with-notes') {
                    matchesFilter = hasNote;
                } else if (filterType === 'without-notes') {
                    matchesFilter = !hasNote;
                } else if (filterType === 'selected-phd') {
                    matchesFilter = isSelected;
                }
                
                let matchesCountry = true;
                if (countryFilter !== 'all') {
                    matchesCountry = nationality === countryFilter;
                }
                
                return matchesSearch && matchesFilter && matchesCountry;
            });
            
            populateNamesList();
        }

        // Populate the names list
        function populateNamesList() {
            const namesList = document.getElementById('namesList');
            const nameCount = document.getElementById('nameCount');
            const notesCount = notesMemory.getAllNotesCount();
            
            // Calculate country statistics for filtered names
            const countryStats = {};
            filteredNames.forEach(name => {
                const nationality = guessNationalityWithOverride(name).nationality;
                countryStats[nationality] = (countryStats[nationality] || 0) + 1;
            });
            
            // Create country breakdown text
            const countryBreakdown = Object.entries(countryStats)
                .sort((a, b) => b[1] - a[1]) // Sort by count descending
                .slice(0, 5) // Show top 5 countries
                .map(([country, count]) => `${country}: ${count}`)
                .join(', ');
            
            // Update count
            nameCount.innerHTML = `
                Total Names: ${names.length} | 
                Showing: ${filteredNames.length} | 
                Notes: ${notesCount}
                ${filteredNames.length < names.length ? `<br><small>Top countries: ${countryBreakdown}</small>` : ''}
            `;
            
            // Clear existing content
            namesList.innerHTML = '';
            
            // Add each name as an item
            filteredNames.forEach((name, index) => {
                namesList.innerHTML += createNameItem(name, index);
            });
            
            // Add event listeners
            addEventListeners();
        }

        // Add event listeners for note functionality
        function addEventListeners() {
            // Note toggle buttons
            document.querySelectorAll('.note-toggle').forEach(button => {
                button.addEventListener('click', function() {
                    const name = this.dataset.name;
                    const noteSection = document.querySelector(`.note-section[data-name="${name}"]`);
                    const noteDisplay = noteSection.querySelector('.note-display');
                    const noteTextarea = noteSection.querySelector('.note-textarea');
                    
                    noteSection.classList.toggle('active');
                    
                    // If opening and has note, show display mode first
                    if (noteSection.classList.contains('active') && notesMemory.hasNote(name)) {
                        noteDisplay.style.display = 'block';
                        noteTextarea.style.display = 'none';
                    } else if (noteSection.classList.contains('active')) {
                        // If no note, go straight to edit mode
                        noteDisplay.style.display = 'none';
                        noteTextarea.style.display = 'block';
                        noteTextarea.focus();
                    }
                });
            });

            // Edit toggle buttons
            document.querySelectorAll('.edit-toggle').forEach(button => {
                button.addEventListener('click', function() {
                    const name = this.dataset.name;
                    const noteSection = document.querySelector(`.note-section[data-name="${name}"]`);
                    const noteDisplay = noteSection.querySelector('.note-display');
                    const noteTextarea = noteSection.querySelector('.note-textarea');
                    
                    if (noteTextarea.style.display === 'none') {
                        // Switch to edit mode
                        noteDisplay.style.display = 'none';
                        noteTextarea.style.display = 'block';
                        noteTextarea.focus();
                        this.textContent = 'View';
                    } else {
                        // Switch to view mode
                        noteDisplay.innerHTML = convertLinksToClickable(noteTextarea.value);
                        noteDisplay.style.display = 'block';
                        noteTextarea.style.display = 'none';
                        this.textContent = 'Edit';
                    }
                });
            });

            // Auto-link detection on space key
            document.querySelectorAll('.note-textarea').forEach(textarea => {
                textarea.addEventListener('keyup', function(e) {
                    if (e.key === ' ') {
                        autoLinkDetection(this);
                    }
                });
                
                textarea.addEventListener('input', function() {
                    // Real-time update of display mode
                    const name = this.dataset.name;
                    const noteDisplay = document.querySelector(`.note-display[data-name="${name}"]`);
                    if (noteDisplay) {
                        noteDisplay.innerHTML = convertLinksToClickable(this.value);
                    }
                });
            });

            // Save note buttons
            document.querySelectorAll('.save-note').forEach(button => {
                button.addEventListener('click', function() {
                    const name = this.dataset.name;
                    const textarea = document.querySelector(`.note-section[data-name="${name}"] .note-textarea`);
                    const noteDisplay = document.querySelector(`.note-section[data-name="${name}"] .note-display`);
                    const note = textarea.value;
                    
                    notesMemory.setNote(name, note);
                    
                    // Update display with clickable links
                    noteDisplay.innerHTML = convertLinksToClickable(note);
                    
                    // Switch to display mode after saving
                    if (note.trim()) {
                        noteDisplay.style.display = 'block';
                        textarea.style.display = 'none';
                        noteDisplay.classList.add('active');
                    }
                    
                    // Update the toggle button
                    const toggleButton = document.querySelector(`.note-toggle[data-name="${name}"]`);
                    const hasNote = notesMemory.hasNote(name);
                    toggleButton.textContent = hasNote ? 'üìù Edit Note' : '‚ûï Add Note';
                    toggleButton.className = `note-toggle ${hasNote ? 'has-note' : ''}`;
                    
                    // Update counts
                    populateNamesList();
                    
                    // Show success feedback
                    const originalText = this.textContent;
                    this.textContent = 'Saved!';
                    this.style.backgroundColor = '#4CAF50';
                    setTimeout(() => {
                        this.textContent = originalText;
                        this.style.backgroundColor = '';
                    }, 1000);
                });
            });

            // Clear note buttons
            document.querySelectorAll('.clear-note').forEach(button => {
                button.addEventListener('click', function() {
                    const name = this.dataset.name;
                    const textarea = document.querySelector(`.note-section[data-name="${name}"] .note-textarea`);
                    
                    if (confirm(`Are you sure you want to clear the note for ${name}?`)) {
                        textarea.value = '';
                        notesMemory.setNote(name, '');
                        
                        // Update the toggle button
                        const toggleButton = document.querySelector(`.note-toggle[data-name="${name}"]`);
                        toggleButton.textContent = '‚ûï Add Note';
                        toggleButton.className = 'note-toggle';
                        
                        // Hide note section
                        const noteSection = document.querySelector(`.note-section[data-name="${name}"]`);
                        noteSection.classList.remove('active');
                        
                        // Update counts
                        populateNamesList();
                    }
                });
            });
            
            // PhD checkbox event delegation - much faster!
            document.querySelectorAll('.phd-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const name = this.dataset.name;
                    togglePhdSelection(name);
                });
            });
        }

        // Search and filter event listeners
        document.addEventListener('DOMContentLoaded', function() {
            populateNamesList();
            updatePhdCounter();
            
            document.getElementById('searchInput').addEventListener('input', filterNames);
            document.getElementById('filterSelect').addEventListener('change', filterNames);
            document.getElementById('countryFilter').addEventListener('change', filterNames);
        });
    </script>
    </script>
</body>
</html>
